<!-- @format -->

<!DOCTYPE html>
<html lang="en">
  <!-- title logo -->
  <link rel="icon" href="/public/images/bse.png" type="image/icon type" />

  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
  />

  <!-- Bootstrap 
<link href="/public/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<script src="/public/plugins/bootstrap/js/bootstrap.min.js"></script> -->

  <!-- MDB5  -->
  <link href="/public/plugins/MDB5-7.2.0/css/mdb.min.css" rel="stylesheet" />
  <script src="/public/plugins/MDB5-7.2.0/js/mdb.es.min.js"></script>

  <!-- jQuery -->
  <script src="/public/plugins/jquery/jquery.min.js"></script>

  <!-- Select2 -->
  <link rel="stylesheet" href="/public/plugins/select2/css/select2.min.css" />
  <script src="/public/plugins/select2/js/select2.min.js"></script>

  <!-- DataTable -->
  <link rel="stylesheet" href="/public/plugins/dataTables/datatables.min.css" />
  <script src="/public/plugins/dataTables/datatables.min.js"></script>
  <script src="/public/plugins/dataTables/dataTables.bootstrap5.min.js"></script>
  <!-- Responsive Datatable -->
  <link
    rel="stylesheet"
    href="/public/plugins/dataTables/datatables.responsive.min.css"
  />
  <script src="/public/plugins/dataTables/datatables.responsive.min.js"></script>

  <!-- Toast -->
  <link rel="stylesheet" href="/public/plugins/Toastr/toastr.min.css" />
  <script src="/public/plugins/Toastr/toastr.min.js"></script>

  <!-- perfect-scrollbar plugin -->
  <script src="/public/plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/public/plugins/font-awesome/css/all.min.css" />

  <!-- jQuery Confirm -->
  <link
    rel="stylesheet"
    href="/public/plugins/jquery-confirm/css/jquery-confirm.min.css"
  />
  <script src="/public/plugins/jquery-confirm/js/jquery-confirm.min.js"></script>

  <!-- Slide-in Panel -->
  <link
    rel="stylesheet"
    href="/public/plugins/slide-in-panel/css/slidePanel.min.css"
  />
  <script src="/public/plugins/slide-in-panel/js/slidePanel.min.js"></script>

  <!-- Tippy -->
  <link rel="stylesheet" href="/public/plugins/tippy/scale.css" />
  <script src="/public/plugins/tippy/popper.min.js"></script>
  <script src="/public/plugins/tippy/tippy-bundle.umd.min.js"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/public/css/style.css" />

  <!-- Custom Script -->
  <script src="/public/custom/App.js"></script>

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BSE</title>

    <style type="text/css">
      @font-face {
        font-family: "CassandraPersonalUse";
        src: url("/public/fonts/CassandraPersonalUse/CassandraPersonalUse-Regular.ttf?v=2")
          format("truetype");
      }

      @font-face {
        font-family: "CerebriSansPro-Regular";
        src: url("/public/fonts/CerebriSansPro/CerebriSansPro-Regular.ttf?v=2")
          format("truetype");
      }

      body {
        font-family: "CerebriSansPro-Regular";
        background-color: #f7f9fd;
      }

      .toast {
        opacity: 1 !important;
      }

      /* Table Pagination */
      .page-item.active .page-link {
        color: #fff !important;
        background-color: #ea5455 !important;
        border-color: #ea5455 !important;
      }

      .page-link {
        color: #000 !important;
        background-color: #fff !important;
        border: 1px solid #dee2e6 !important;
      }

      .page-link:hover {
        color: #fff !important;
        background-color: #f17979 !important;
        border-color: #ea5455 !important;
      }
    </style>
  </head>

  <body>
    <div class="">
      <!-- Table Content -->
      <div class="rounded-2 d-flex justify-content-center mt-4 py-4">
        <div class="p-4 w-100">
          <!-- Buttons -->
          <div class="d-flex rounded-2 justify-content-end pb-4">
            <!-- Filter Button -->
            <div
              id="openDispatchPanelBtn"
              class="btn btn-outline-danger d-flex justify-content-around mx-3"
              style="width: 100px"
            >
              <i class="fa-solid fa-filter my-auto"></i>
              <span style="margin-top: 4px" class="fw-bold my-auto"
                >Filter</span
              >
            </div>

            <!-- Add Button -->
            <div
              id="openDispatchPanelBtn"
              class="btn btn-outline-danger d-flex justify-content-around"
              style="width: 100px"
            >
              <i class="fa-solid fa-circle-plus my-auto"></i>
              <span style="margin-top: 4px" class="fw-bold my-auto">Add</span>
            </div>
          </div>

          <table id="dispatchTable" class="table table-hover nowrap w-100">
            <thead>
              <tr>
                <th></th>
                <th></th>
                <th class="fw-bold"><span>Lot No</span></th>
                <th class="fw-bold"><span>Collection Center</span></th>
                <th class="fw-bold"><span>Entry Date</span></th>
                <th class="fw-bold"><span>Bill No</span></th>
                <th class="fw-bold"><span>Species</span></th>
                <th class="fw-bold"><span>Quantity</span></th>
                <th class="fw-bold"><span>Created At</span></th>
              </tr>
            </thead>
          </table>
        </div>
      </div>
    </div>
  </body>

  <script type="text/javascript">
    jQuery(document).ready(function ($) {
      // Declarations
      toastr.options = {
        closeButton: false,
        debug: false,
        newestOnTop: true,
        progressBar: true,
        positionClass: "toast-top-right",
        preventDuplicates: false,
        onclick: null,
        showDuration: "300",
        hideDuration: "1000",
        timeOut: "5000",
        extendedTimeOut: "1000",
        showEasing: "swing",
        hideEasing: "linear",
        showMethod: "fadeIn",
        hideMethod: "fadeOut",
      };

      $("#dispatchTable").DataTable({
        // searching: true,
        destroy: true,
        responsive: false,
        processing: true,
        serverSide: true,
        scrollX: true,
        scrollY: "40vh",
        ordering: false,
        ajax: {
          type: "GET",
          url: "/api/v1/dispatch/get/all",
          error: function (xhr, error, code) {
            $("#dispatchTable").DataTable().destroy();
            $("#dispatchTable").DataTable({ scrollX: true, ordering: false });

            if (xhr["status"] == 420) {
              toastr["warning"](xhr["responseJSON"]["message"]);
            } else {
              toastr["error"](xhr["responseJSON"]["message"]);
            }
          },
          dataSrc: function (json) {
            json.iTotalRecords = json.data?.rows?.length;
            json.iTotalDisplayRecords = json.data?.count;

            // Return the data to be displayed in the DataTable
            return json?.data?.rows;
          },
        },
        columns: [
          { data: null },
          { data: null },
          { data: "lot_no" },
          { data: "UnitMaster.unit_name" },
          { data: "entry_date" },
          { data: "bill_no" },
          { data: "SpeciesMaster.species_name" },
          { data: "quantity" },
          { data: "created_at" },
        ],
        columnDefs: [
          {
            targets: [0],
            className: "text-left",
            render: function (data, type, row) {
              return (
                '<i class="fa fa-pen-to-square edit editDivision" division_master_id=' +
                row["id"] +
                ' aria-hidden="true" style="font-size:15px;color:#f07b3f" data-toggle="tooltip" data-placement="top" title="Click this button to edit this division"></i>'
              );
            },
          },
          {
            targets: [1],
            className: "text-left",
            render: function (data, type, row) {
              return (
                '<i class="fa fa-trash del delDivision" division_master_id=' +
                row["id"] +
                ' aria-hidden="true" style="font-size:15px;color:#f07b3f" data-toggle="tooltip" data-placement="top" title="Click this button to delete this division"></i>'
              );
            },
          },
          {
            targets: [3],
            className: "text-left",
            render: function (data, type, row) {
              return `<span unit_master_id='${row["UnitMaster"].id}'>${data}</span>`;
            },
          },
          {
            targets: [6],
            className: "text-left",
            render: function (data, type, row) {
              return `<span species_master_id='${row["SpeciesMaster"].id}'>${data}</span>`;
            },
          },
          {
            targets: [8],
            className: "text-left",
            render: function (data, type, row) {
              const date = new Date(row["created_at"]);

              var months = [
                "Jan",
                "Feb",
                "Mar",
                "Apr",
                "May",
                "Jun",
                "Jul",
                "Aug",
                "Sep",
                "Oct",
                "Nov",
                "Dec",
              ];
              var hours = date.getHours();
              var minutes = date.getMinutes();
              var ampm = hours >= 12 ? "PM" : "AM";
              hours = hours % 12;
              hours = hours ? hours : 12; // Handle midnight (0 hours)
              minutes = minutes < 10 ? "0" + minutes : minutes;
              var strTime = hours + ":" + minutes + " " + ampm;
              var month = months[date.getMonth()];
              var day = date.getDate().toString().padStart(2, "0"); // Ensure day is always two digits
              return (
                day + "-" + month + "-" + date.getFullYear() + " " + strTime
              );
            },
          },
        ],
      });
    });
  </script>
</html>
